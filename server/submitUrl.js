const request = require("request");

exports.start = (event, callback) => {
    console.log("BODY: ", JSON.parse(event));
    
    sendMessage(event)
    .then((body) => {
        callback(body);
    })
    .catch((err) => {
        callback(err);
    });

}

function sendMessage(scanUrl) {
    return new Promise((resolve, reject) => {

        var options = {
            method: "POST",
            url: 'https://www.virustotal.com/vtapi/v2/url/report',
            qs: {
                resource: scanUrl,
                apikey: '48b2abe33cca0ec3dbc468d90f0c2c1cf2441eed15f8c5c4de223deda5b2d10a',
                scan: 1
            }
        };
    
        request(options, (err, response, body) => {
                if(err) {
                    console.log("SEND_MESSAGE_FAILURE: ", err);
                    reject(`SEND_MESSAGE_FAILURE: ${err}`);
                }
                else {
                    console.log("SEND_MESSAGE_SUCCESS: ", body);
                    resolve(body);
                }
            }
        );

    });
}