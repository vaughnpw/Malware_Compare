
import Head from 'next/head';
import { Component } from "react";
import {
  Layout, Menu, Input, Icon, Button, Upload, message, Col
} from 'antd';

const { SubMenu } = Menu;
const { Header, Content, Sider, Footer } = Layout;

import Router from 'next/router'; 

const props = {
  name: 'file',
  multiple: false,
  accept: '.doc,.docx,.ppt,.pptx,.pdf,.png,.jpg,.txt',
  directory: false,
  method: 'POST',
  action: '/upload'
};

class CustomLayout extends Component {

  state = {
    loading: false,
    iconLoading: false,
  }

  onCollapse = (collapsed) => {
    console.log(collapsed);
    this.setState({ collapsed });
  }

  constructor(props) {
    super(props);
    this.state = {
      collapsed: true,
      fileList: [],
      link: ""
    };
  }

  handleSubmitFiles = async (event) => {
    const status = event.file.status;
    if (status !== 'uploading') {
      console.log('file uploading: ', event.file);
      console.log('current file list: ', event.fileList);
    }
    if (status === 'done') {
      message.success(`${event.file.name} file uploaded successfully.`);
      console.log(`${event.file.name} file uploaded successfully.`);
      const body = {
        file: {
          name: event.file.name,
          type: event.file.type
        }
      };
      try {  
        const res = await fetch('https://ms4axfydt9.execute-api.us-east-1.amazonaws.com/dev/submitFile',
          {
            method: 'POST',
            headers: {
              'Access-Control-Allow-Origin': '*',
				      'Access-Control-Allow-Credentials': true,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          }
        );
        const json = await res.json();
        console.log('json returned from fetch: ', json);
        console.log('resource id from json: ', json.resource);
        message.success(`${event.file.name} file scanned successfully.`);
        Router.push({ 
          pathname: '/compare', 
          query: { 
            resources: JSON.stringify(json.resource)
          }, 
        });
      } catch(e) {
        message.error(`${event.file.name} file scan failed.`);
        console.log('error message: ', e);
        console.log(`${event.file.name} file scan failed.`);
      }
    } else if (status === 'error') {
      message.error(`${event.file.name} file upload failed.`);
      console.log(`${event.file.name} file upload failed.`);
    }
  }

  // handleSubmitLink = async (event) => {
  //   console.log('enter: ', event);
  //   console.log('target: ', event.currentTarget.value);
  //   try {  
  //     const res = await fetch('https://ms4axfydt9.execute-api.us-east-1.amazonaws.com/dev/submitUrl',
  //       {
  //         method: 'POST',
  //         headers: {
  //           'Access-Control-Allow-Origin': '*',
  //           'Access-Control-Allow-Credentials': true,
  //           'Content-Type': 'application/json'
  //         },
  //         body: event.currentTarget.value
  //       }
  //     );
  //     const json = await res.json();
  //     console.log('json returned from fetch: ', json);
  //     console.log('resource id from json: ', json.resource);
  //     message.success(`http://${event.currentTarget.value} url scanned successfully.`);
  //     Router.push({ 
  //       pathname: '/compare', 
  //       query: { 
  //         resources: JSON.stringify(json.resource)
  //       }, 
  //     });
  //   } catch(e) {
  //     message.error(`http://${event.currentTarget.value} url scan failed.`);
  //     console.log('error message: ', e);
  //     console.log(`http://${event.currentTarget.value} url scan failed.`);
  //   }
  // }

  render() {
    return(
      <Layout>
      <Header className="header" style={{ background: '#fff', boxShadow: '0 2px 8px #f0f1f2', backgroundClip: 'border-box', position: 'fixed', zIndex: 1, width: '100%', height: '84px'}}>
        <div className="header-row">
          <div className="logo_left">
            <a id="logo" href="/">
              <img 
                alt="Malware Compare" 
                src="https://s3.amazonaws.com/com.malware.compare/img/malware_compare/malware_compare_logo.svg"
              />
            </a>
          </div>
          <div className="top_right_nav">
            <Menu
              theme="light"
              mode="horizontal"
              defaultSelectedKeys={['1']}
              style={{ lineHeight: '64px', height: 'inherit' }}
            >
              <Menu.Item key="top_home_nav" style={{ marginTop: '18px' }}><a id="home" href="/"><Icon type="home"/>Home</a></Menu.Item>
              <Menu.Item key="top_compare_nav" style={{ marginTop: '18px' }}><a id="compare" href="/compare"><Icon type="diff"/>Compare</a></Menu.Item>
            </Menu>
          </div>
          <style jsx>{`
            .top_right_nav {
              margin-left: 25px;
              float: right;
            }
            .logo_left {
              margin-right: 30px;
              float: left;
            }
            .logo_left img {
              margin-right: 250px;
              padding: 10px;
              width: 300px;
              height: auto;
            }
          `}</style>
        </div>
      </Header>
      <Layout>
      {/* <Sider 
          collapsible
          collapsed={this.state.collapsed}
          onCollapse={this.onCollapse}
          width={250} 
          style={{ marginTop: 84 }}
        >
          <Menu
            mode="inline"
            style={{ height: '100%', marginTop: 25, borderRight: 0}}
          >
            <SubMenu key="upload_file_dd" title={<span><Icon type="upload" style={{ color: '#637282' }}/><span>Upload File</span></span>}>
              <Menu.Item key="upload_file_dd_btn">
                <Upload {...props} onChange={this.handleSubmitFiles}>
                  <Button>
                    <Icon type="folder-add"/>Browse
                  </Button>
                </Upload>
              </Menu.Item>
            </SubMenu>
            <SubMenu key="insert_link_dd" style={{ marginTop: 20 }} title={<span><Icon type="link" style={{ color: '#637282' }}/><span>Insert Link</span></span>}>
              <Menu.Item key="insert_link_dd_btn">  
                <div style={{ marginBottom: 16 }}>
                  <Input 
                    size="default" 
                    addonBefore="http://"
                    defaultValue="www.malware_site.gov" 
                    onPressEnter={this.handleSubmitLink}
                  />
                </div>   
              </Menu.Item>
            </SubMenu>
          </Menu>
        </Sider> */}
        <Layout style={{ padding: 24, marginTop: 84 }}>
          <Content style={{background: '#fff', padding: 24, margin: 0, minHeight: 280}}>
            {this.props.children}
          </Content>
          <Footer>
            <Col span={8}/>
            <Col span={8}>
              Malware Compare â˜º2019 Created by _vawn__
            </Col>
            <Col span={8}/>
          </Footer>
        </Layout>
      </Layout>
    </Layout>
    );
  }

}

export default CustomLayout